<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Filter syntax - Just One Single History</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
                <link rel="stylesheet" href="../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../intro.html"><strong aria-hidden="true">1.</strong> Intro</a></li><li class="chapter-item expanded "><a href="../usecases.html"><strong aria-hidden="true">2.</strong> Use cases</a></li><li class="chapter-item expanded "><a href="../faq.html"><strong aria-hidden="true">3.</strong> FAQ</a></li><li class="chapter-item expanded affix "><li class="part-title">Guide</li><li class="chapter-item expanded "><a href="../guide/gettingstarted.html"><strong aria-hidden="true">4.</strong> Getting started</a></li><li class="chapter-item expanded "><a href="../guide/workspaces.html"><strong aria-hidden="true">5.</strong> Working with workspaces</a></li><li class="chapter-item expanded "><a href="../guide/importing.html"><strong aria-hidden="true">6.</strong> Importing projects</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Integrating with CI</div></li><li class="chapter-item expanded affix "><li class="part-title">Reference</li><li class="chapter-item expanded "><a href="../reference/filters.html" class="active"><strong aria-hidden="true">8.</strong> Filter syntax</a></li><li class="chapter-item expanded "><a href="../reference/proxy.html"><strong aria-hidden="true">9.</strong> Proxy</a></li><li class="chapter-item expanded "><a href="../reference/workspace.html"><strong aria-hidden="true">10.</strong> Workspaces</a></li><li class="chapter-item expanded "><a href="../reference/container.html"><strong aria-hidden="true">11.</strong> Container configuration</a></li><li class="chapter-item expanded "><a href="../reference/cli.html"><strong aria-hidden="true">12.</strong> Command line tools</a></li><li class="chapter-item expanded "><a href="../reference/graphql.html"><strong aria-hidden="true">13.</strong> Graphql API</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">14.</strong> Handlebar generator</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.</strong> The josh UI</div></li><li class="chapter-item expanded affix "><li class="part-title">Contributing</li><li class="chapter-item expanded "><a href="../contributing/testing.html"><strong aria-hidden="true">16.</strong> Testing</a></li><li class="chapter-item expanded "><a href="../contributing/dev-tools.html"><strong aria-hidden="true">17.</strong> Development tools</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">18.</strong> Tracing</div></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Just One Single History</h1>

                    <div class="right-buttons">
                                                <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="history-filtering"><a class="header" href="#history-filtering">History filtering</a></h1>
<p>Josh transforms commits by applying filters to them. As any
commit in git represents not just a single state of the file system but also its entire
history, applying a filter to a commit produces an entirely new history.
The result of a filter is a normal git commit and therefore can be filtered again,
making filters chainable.</p>
<h2 id="syntax"><a class="header" href="#syntax">Syntax</a></h2>
<p>Filters always begin with a colon and can be chained:</p>
<pre><code>:filter1:filter2
</code></pre>
<p>When used as part of an URL filters cannot contain white space or newlines. When read from a file
however white space can be inserted between filters (not after the leading colon).
Additionally newlines can be used instead of <code>,</code> inside of composition filters.</p>
<p>Some filters take arguments, and arguments can optionally be quoted using double quotes,
if special characters used by the filter language need to be used (like <code>:</code> or space):</p>
<pre><code>:filter=argument1,&quot;argument2&quot;
</code></pre>
<h2 id="available-filters"><a class="header" href="#available-filters">Available filters</a></h2>
<h3 id="subdirectory-a"><a class="header" href="#subdirectory-a">Subdirectory <strong><code>:/a</code></strong></a></h3>
<p>Take only the selected subdirectory from the input and make it the root
of the filtered tree.
Note that <code>:/a/b</code> and <code>:/a:/b</code> are equivalent ways to get the same result.</p>
<h3 id="directory-a"><a class="header" href="#directory-a">Directory <strong><code>::a/</code></strong></a></h3>
<p>A shorthand for the commonly occurring filter combination <code>:/a:prefix=a</code>.</p>
<h3 id="file-a"><a class="header" href="#file-a">File <strong><code>::a</code></strong></a></h3>
<p>Produces a tree with only the specified file in it's root.
Note that <code>::a/b</code> is equivalent to <code>::a/::b</code>.</p>
<h3 id="prefix-prefixa"><a class="header" href="#prefix-prefixa">Prefix <strong><code>:prefix=a</code></strong></a></h3>
<p>Take the input tree and place it into subdirectory <code>a</code>.
Note that <code>:prefix=a/b</code> and <code>:prefix=b:prefix=a</code> are equivalent.</p>
<h3 id="composition-filter1filter2filtern"><a class="header" href="#composition-filter1filter2filtern">Composition <strong><code>:[:filter1,:filter2,...,:filterN]</code></strong></a></h3>
<p>Compose a tree by overlaying the outputs of <code>:filter1</code> ... <code>:filterN</code> on top of each other.
It is guaranteed that each file will only appear at most once in the output. The first filter
that consumes a file is the one deciding it's mapped location. Therefore the order in which
filters are composed matters.</p>
<p>Inside of a composition <code>x=:filter</code> can be used as an alternative spelling for
<code>:filter:prefix=x</code>.</p>
<h3 id="exclusion-excludefilter"><a class="header" href="#exclusion-excludefilter">Exclusion <strong><code>:exclude[:filter]</code></strong></a></h3>
<p>Remove all paths present in the <em>output</em> of <code>:filter</code> from the input tree.
It should generally be avoided to use any filters that change paths and instead only
use filters that select paths without altering them.</p>
<h3 id="workspace-workspacea"><a class="header" href="#workspace-workspacea">Workspace <strong><code>:workspace=a</code></strong></a></h3>
<p>Similar to <code>:/a</code> but also looks for a <code>workspace.josh</code> file inside the
specified directory (called the &quot;workspace root&quot;).
The resulting tree will contain the contents of the
workspace root as well as additional files specified in the <code>workspace.josh</code> file.
(see <a href="./workspace.html">Workspaces</a>)</p>
<h3 id="text-replacement-replaceregex_0replacement_0regex_nreplacement_n"><a class="header" href="#text-replacement-replaceregex_0replacement_0regex_nreplacement_n">Text replacement <strong><code>:replace(&quot;regex_0&quot;:&quot;replacement_0&quot;,...,&quot;regex_N&quot;:&quot;replacement_N&quot;)</code></strong></a></h3>
<p>Applies the supplied regular expressions to every file in the input tree.</p>
<h3 id="signature-removal-unsign"><a class="header" href="#signature-removal-unsign">Signature removal <strong><code>:unsign</code></strong></a></h3>
<p>The default behaviour of Josh is to copy, if it exists, the signature of the original commit in
the filtered commit. This makes the signature invalid, but allows a perfect round-trip: josh will be
able to recreate the original commit from the filtered one.</p>
<p>This behaviour might not be desirable, and this filter drops the signatures from the history.</p>
<h2 id="pattern-filters"><a class="header" href="#pattern-filters">Pattern filters</a></h2>
<p>The following filters accept a glob like pattern <code>X</code> that can contain <code>*</code> to
match any number of characters. Note that two or more consecutive wildcards (<code>**</code>) are not
allowed.</p>
<h3 id="match-directories-x"><a class="header" href="#match-directories-x">Match directories <strong><code>::X/</code></strong></a></h3>
<p>All matching subdirectories in the input root</p>
<h3 id="match-files-or-directories-x"><a class="header" href="#match-files-or-directories-x">Match files or directories <strong><code>::X</code></strong></a></h3>
<p>All matching files or directories in the input root</p>
<h3 id="match-nested-directories-x"><a class="header" href="#match-nested-directories-x">Match nested directories <strong><code>::**/X/</code></strong></a></h3>
<p>All subdirectories matching the pattern in arbitrarily deep subdirectories of the input</p>
<h3 id="match-nested-files-x"><a class="header" href="#match-nested-files-x">Match nested files <strong><code>::**/X</code></strong></a></h3>
<p>All files matching the pattern in arbitrarily deep subdirectories of the input</p>
<h2 id="history-filters"><a class="header" href="#history-filters">History filters</a></h2>
<p>These filter do not modify git trees, but instead only operate on the commit graph.</p>
<h3 id="linearise-history-linear"><a class="header" href="#linearise-history-linear">Linearise history <strong>:linear</strong></a></h3>
<p>Produce a filtered history that does not contain any merge commits. This is done by
simply dropping all parents except the first on every commit.</p>
<h3 id="filter-specific-parts-of-the-history-revsha_0filter_0sha_nfilter_n"><a class="header" href="#filter-specific-parts-of-the-history-revsha_0filter_0sha_nfilter_n">Filter specific parts of the history <strong>:rev(&lt;sha_0&gt;:filter_0,...,&lt;sha_N&gt;:filter_N)</strong></a></h3>
<p>Produce a history where the commits specified by <code>&lt;sha_N&gt;</code> are replaced by the result of applying
<code>:filter_N</code> to it.</p>
<p>It will appear like <code>&lt;sha_N&gt;</code> and all its ancestors are also filtered with <code>&lt;filter_N&gt;</code>. If an
ancestor also has a matching entry in the <code>:rev(...)</code> it's filter will <em>replace</em> <code>&lt;filter_N&gt;</code>
for all further ancestors (and so on).</p>
<p>This special value <code>0000000000000000000000000000000000000000</code> can be used as a <code>&lt;sha_n&gt;</code> to filter
commits that don't match any of the other shas.</p>
<h3 id="join-multiple-histories-into-one-joinsha_0filter_0sha_nfilter_n"><a class="header" href="#join-multiple-histories-into-one-joinsha_0filter_0sha_nfilter_n">Join multiple histories into one <strong>:join(&lt;sha_0&gt;:filter_0,...,&lt;sha_N&gt;:filter_N)</strong></a></h3>
<p>Produce the history that would be the result of pushing the passed branches with the
passed filters into the upstream.</p>
<h2 id="filter-order-matters"><a class="header" href="#filter-order-matters">Filter order matters</a></h2>
<p>Filters are applied in the left-to-right order they are given in the filter specification,
and they are <code>not</code> commutative.</p>
<p>For example, this command will filter out just the josh documentation, and store it in a
ref named <code>FILTERED_HEAD</code>:</p>
<pre><code>$ josh-filter :/docs:prefix=josh-docs
</code></pre>
<p>However, <code>this</code> command will produce an empty branch:</p>
<pre><code>$ josh-filter :prefix=josh-docs:/docs
</code></pre>
<p>What's happening in the latter command is that because the prefix filter is applied first, the
entire <code>josh</code> history already lives within the <code>josh-docs</code> directory, as it was just
transformed to exist there. Thus, to still get the docs, the command would need to be:</p>
<pre><code>$ josh-filter :prefix=josh-docs:/josh-docs/docs
</code></pre>
<p>which will contain the josh documentation at the base of the tree. We've lost the prefix, what
gives?? Because the original git tree was already transformed, and then the subdirectory filter
was applied to pull documentation from <code>josh-docs/docs</code>, the prefix is gone - it was filtered out
again by the subdirectory filter. Thus, the order in which filters are provided is crucial, as each
filter further transforms the latest transformation of the tree.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../guide/importing.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../reference/proxy.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../guide/importing.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../reference/proxy.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
