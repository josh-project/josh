<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Filter syntax - Just One Single History</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-1bf21ddd.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-e9bc00a4.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Just One Single History</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="history-filtering"><a class="header" href="#history-filtering">History filtering</a></h1>
<p>Josh transforms commits by applying filters to them. As any
commit in git represents not just a single state of the file system but also its entire
history, applying a filter to a commit produces an entirely new history.
The result of a filter is a normal git commit and therefore can be filtered again,
making filters chainable.</p>
<h2 id="syntax"><a class="header" href="#syntax">Syntax</a></h2>
<p>Filters always begin with a colon and can be chained:</p>
<pre><code>:filter1:filter2
</code></pre>
<p>When used as part of an URL filters cannot contain white space or newlines. When read from a file
however white space can be inserted between filters (not after the leading colon).
Additionally newlines can be used instead of <code>,</code> inside of composition filters.</p>
<p>Some filters take arguments, and arguments can optionally be quoted using double quotes,
if special characters used by the filter language need to be used (like <code>:</code> or space):</p>
<pre><code>:filter=argument1,"argument2"
</code></pre>
<h2 id="filter-options-key1value1key2value2filter"><a class="header" href="#filter-options-key1value1key2value2filter">Filter options <strong><code>:~(key1="value1",key2="value2")[:filter]</code></strong></a></h2>
<p>The <code>:~(...)[]</code> syntax allows you to provide filter options (metadata) that affect how the filter
is applied. The options are specified as key-value pairs in parentheses, followed by the actual
filter in square brackets.</p>
<p><strong>Syntax:</strong></p>
<pre><code>:~(option1="value1",option2="value2")[:filter]
</code></pre>
<p>Multiple options can be specified by separating them with commas. Option values must be quoted
using double quotes.</p>
<p><strong>Example:</strong></p>
<pre><code>:~(key1="value1",key2="value2")[:/sub1]
</code></pre>
<p>This applies the <code>:/sub1</code> filter with the specified options attached as metadata.</p>
<h3 id="history-option"><a class="header" href="#history-option">History option</a></h3>
<p>The <code>history</code> option controls how the commit history is processed during filtering.
It affects both how commits are walked and how merge commits are handled in the output history.</p>
<p><strong>Available values:</strong></p>
<ul>
<li>
<p><strong><code>history="linear"</code></strong> - Produces a linear history by converting merge commits into regular commits,
creating a linear chain of commits in the output history.</p>
<p><strong>Example:</strong></p>
<pre><code>:~(history="linear")[:/sub1]
</code></pre>
</li>
<li>
<p><strong><code>history="keep-trivial-merges"</code></strong> - Prevents dropping trivial merge commits that would
normally be pruned from the output history.</p>
<p>Normally, Josh will drop merge commits from the filtered history if their filtered tree is
identical to the first parent’s tree. Setting this option to <code>"keep-trivial-merges"</code> preserves
these commits in the output history.</p>
<p><strong>Example:</strong></p>
<pre><code>:~(history="keep-trivial-merges")[::file1]
</code></pre>
<p><strong>Note for users of older versions:</strong> In older versions of Josh, <code>"keep-trivial-merges"</code> was the
default behavior. If you’re upgrading from an older version and need to recreate the same history
structure, you should explicitly set <code>history="keep-trivial-merges"</code> in your filter options.</p>
</li>
</ul>
<h2 id="available-filters"><a class="header" href="#available-filters">Available filters</a></h2>
<h3 id="subdirectory-a"><a class="header" href="#subdirectory-a">Subdirectory <strong><code>:/a</code></strong></a></h3>
<p>Take only the selected subdirectory from the input and make it the root
of the filtered tree.
Note that <code>:/a/b</code> and <code>:/a:/b</code> are equivalent ways to get the same result.</p>
<h3 id="directory-a"><a class="header" href="#directory-a">Directory <strong><code>::a/</code></strong></a></h3>
<p>A shorthand for the commonly occurring filter combination <code>:/a:prefix=a</code>.</p>
<h3 id="file-a-or-destinationsource"><a class="header" href="#file-a-or-destinationsource">File <strong><code>::a</code></strong> or <strong><code>::destination=source</code></strong></a></h3>
<p>Produces a tree with only the specified file.</p>
<p>When using a single argument (<code>::a</code>), the file is placed at the same full path as in the source tree.
When using the <code>destination=source</code> syntax (<code>::destination=source</code>), the file is renamed from <code>source</code> to <code>destination</code> in the filtered tree.</p>
<p>Examples:</p>
<ul>
<li><code>::file.txt</code> - Selects <code>file.txt</code> and places it at <code>file.txt</code></li>
<li><code>::src/file.txt</code> - Selects <code>src/file.txt</code> and places it at <code>src/file.txt</code></li>
<li><code>::renamed.txt=src/original.txt</code> - Selects <code>src/original.txt</code> and places it at <code>renamed.txt</code></li>
<li><code>::subdir/file.txt=src/file.txt</code> - Selects <code>src/file.txt</code> and places it at <code>subdir/file.txt</code></li>
</ul>
<p>Note that <code>::a/b</code> is equivalent to <code>::a/::b</code>.
Pattern filters (with <code>*</code>) cannot be combined with the <code>destination=source</code> syntax.</p>
<h3 id="prefix-prefixa"><a class="header" href="#prefix-prefixa">Prefix <strong><code>:prefix=a</code></strong></a></h3>
<p>Take the input tree and place it into subdirectory <code>a</code>.
Note that <code>:prefix=a/b</code> and <code>:prefix=b:prefix=a</code> are equivalent.</p>
<h3 id="composition-filter1filter2filtern"><a class="header" href="#composition-filter1filter2filtern">Composition <strong><code>:[:filter1,:filter2,...,:filterN]</code></strong></a></h3>
<p>Compose a tree by overlaying the outputs of <code>:filter1</code> … <code>:filterN</code> on top of each other.
It is guaranteed that each file will only appear at most once in the output. The first filter
that consumes a file is the one deciding it’s mapped location. Therefore the order in which
filters are composed matters.</p>
<p>Inside of a composition <code>x=:filter</code> can be used as an alternative spelling for
<code>:filter:prefix=x</code>.</p>
<h3 id="exclusion-excludefilter"><a class="header" href="#exclusion-excludefilter">Exclusion <strong><code>:exclude[:filter]</code></strong></a></h3>
<p>Remove all paths present in the <em>output</em> of <code>:filter</code> from the input tree.
It should generally be avoided to use any filters that change paths and instead only
use filters that select paths without altering them.</p>
<h3 id="invert-invertfilter"><a class="header" href="#invert-invertfilter">Invert <strong><code>:invert[:filter]</code></strong></a></h3>
<p>A shorthand syntax that applies the inverse of the composed filter. The inverse of a filter is
a filter that undoes the transformation. For example, the inverse of <code>:/sub1</code> (subdirectory)
is <code>:prefix=sub1</code> (prefix), and vice versa.</p>
<p><strong>Example:</strong></p>
<pre><code>:invert[:/sub1]
</code></pre>
<p>This is equivalent to <code>:prefix=sub1</code>, which takes the input tree and places it into
the <code>sub1</code> subdirectory.</p>
<p>Multiple filters can be provided in the compose:</p>
<pre><code>:invert[:/sub1,:/sub2]
</code></pre>
<p>This inverts the composition of <code>:/sub1</code> and <code>:/sub2</code>.</p>
<h3 id="scope-x"><a class="header" href="#scope-x">Scope <strong><code>:&lt;X&gt;[..]</code></strong></a></h3>
<p>A shorthand syntax that expands to <code>:X:[..]:invert[:X]</code>, where:</p>
<ul>
<li><code>:X</code> is a filter (without built-in compose)</li>
<li><code>:[..]</code> is a compose filter (like in <code>:exclude</code>)</li>
</ul>
<p>This filter first applies <code>:X</code> to scope the input, then applies the compose filter <code>:[..]</code>,
and finally inverts <code>:X</code> to restore the original scope. This is useful when you want to
apply a composition filter within a specific scope and then restore the original structure.</p>
<p><strong>Example:</strong></p>
<pre><code>:&lt;:/sub1&gt;[::file1,::file2]
</code></pre>
<p>This is equivalent to <code>:/sub1:[::file1,::file2]:invert[:/sub1]</code>, which:</p>
<ol>
<li>Selects the <code>sub1</code> subdirectory (applies <code>:/sub1</code>)</li>
<li>Applies the composition filter to select <code>file1</code> and <code>file2</code> (applies <code>:[::file1,::file2]</code>)</li>
<li>Restores the original scope by inverting the subdirectory selection (applies <code>:invert[:/sub1]</code>)</li>
</ol>
<h3 id="stored-pathtofile"><a class="header" href="#stored-pathtofile">Stored <strong><code>:+path/to/file</code></strong></a></h3>
<p>Looks for a file with a <code>.josh</code> extension at the specified path and applies the filter defined in that file.
The path argument should be provided <em>without</em> the <code>.josh</code> extension, as it will be automatically appended.</p>
<p>For example, <code>:+st/config</code> will look for a file at <code>st/config.josh</code> and apply the filter defined in that file.
The resulting tree will contain the contents specified by the filter in the <code>.josh</code> file.</p>
<p>Stored filters apply from the root of the repository, making them useful for configuration files that define
filters to be applied at the repository root level.</p>
<h3 id="workspace-workspacea"><a class="header" href="#workspace-workspacea">Workspace <strong><code>:workspace=a</code></strong></a></h3>
<p>Like stored filters, but with an additional “base” component that first selects the specified directory
(called the “workspace root”) before applying the filter from the <code>workspace.josh</code> file inside it.</p>
<p>The workspace filter is equivalent to <code>:/a</code> combined with applying a stored filter, where the filter is read
from <code>workspace.josh</code> within the selected directory. The resulting tree will contain the contents of the
workspace root as well as additional files specified in the <code>workspace.josh</code> file.
(see <a href="./workspace.html">Workspaces</a>)</p>
<h3 id="text-replacement-replaceregex_0replacement_0regex_nreplacement_n"><a class="header" href="#text-replacement-replaceregex_0replacement_0regex_nreplacement_n">Text replacement <strong><code>:replace("regex_0":"replacement_0",...,"regex_N":"replacement_N")</code></strong></a></h3>
<p>Applies the supplied regular expressions to every file in the input tree.</p>
<h3 id="signature-removal-unsign"><a class="header" href="#signature-removal-unsign">Signature removal <strong><code>:unsign</code></strong></a></h3>
<p>The default behaviour of Josh is to copy, if it exists, the signature of the original commit in
the filtered commit. This makes the signature invalid, but allows a perfect round-trip: josh will be
able to recreate the original commit from the filtered one.</p>
<p>This behaviour might not be desirable, and this filter drops the signatures from the history.</p>
<h2 id="pattern-filters"><a class="header" href="#pattern-filters">Pattern filters</a></h2>
<p>The following filters accept a glob like pattern <code>X</code> that can contain <code>*</code> to
match any number of characters. Note that two or more consecutive wildcards (<code>**</code>) are not
allowed.</p>
<h3 id="match-directories-x"><a class="header" href="#match-directories-x">Match directories <strong><code>::X/</code></strong></a></h3>
<p>All matching subdirectories in the input root</p>
<h3 id="match-files-or-directories-x"><a class="header" href="#match-files-or-directories-x">Match files or directories <strong><code>::X</code></strong></a></h3>
<p>All matching files or directories in the input root</p>
<h3 id="match-nested-directories-x"><a class="header" href="#match-nested-directories-x">Match nested directories <strong><code>::**/X/</code></strong></a></h3>
<p>All subdirectories matching the pattern in arbitrarily deep subdirectories of the input</p>
<h3 id="match-nested-files-x"><a class="header" href="#match-nested-files-x">Match nested files <strong><code>::**/X</code></strong></a></h3>
<p>All files matching the pattern in arbitrarily deep subdirectories of the input</p>
<h2 id="history-filters"><a class="header" href="#history-filters">History filters</a></h2>
<p>These filter do not modify git trees, but instead only operate on the commit graph.</p>
<h3 id="linearise-history-linearfilter"><a class="header" href="#linearise-history-linearfilter">Linearise history <strong>:linear[:filter]</strong></a></h3>
<p>Produce a filtered history that does not contain any merge commits. This is done by
simply dropping all parents except the first on every commit.</p>
<h3 id="filter-specific-parts-of-the-history-rev"><a class="header" href="#filter-specific-parts-of-the-history-rev">Filter specific parts of the history <strong>:rev(…)</strong></a></h3>
<p>The <code>:rev(...)</code> filter allows you to apply different filters to different parts of the commit history based on commit relationships. Each entry in the filter specifies a condition and a filter to apply when that condition matches.</p>
<p><strong>Syntax:</strong></p>
<pre><code>:rev(
  &lt;operator&gt;&lt;sha&gt;:filter
  _:filter
  ...
)
</code></pre>
<p>Commit references must be <strong>full 40-character SHA-1 hashes</strong>; short/abbreviated SHAs are not accepted.</p>
<p><strong>Operators:</strong></p>
<ul>
<li><strong><code>&lt;</code></strong> - Strict ancestor match: matches if the commit is an ancestor of <code>&lt;sha&gt;</code> AND the commit is not equal to <code>&lt;sha&gt;</code></li>
<li><strong><code>&lt;=</code></strong> - Inclusive ancestor match: matches if the commit is an ancestor of <code>&lt;sha&gt;</code> OR the commit equals <code>&lt;sha&gt;</code></li>
<li><strong><code>==</code></strong> - Exact match: matches only if the commit equals <code>&lt;sha&gt;</code></li>
<li><strong><code>_</code></strong> - Default filter: matches any commit that doesn’t match any previous condition (no SHA needed)</li>
</ul>
<p><strong>Matching behavior:</strong></p>
<ul>
<li>Rules are evaluated in the order they are specified</li>
<li><strong>First match wins</strong> - once a condition matches, that filter is applied and no further rules are checked</li>
<li>The default filter (<code>_</code>) will match any commit that hasn’t matched a previous rule, making any rules after it unreachable</li>
</ul>
<p><strong>Examples:</strong></p>
<pre><code>:rev(==def4567890123456789012345678901234567890:prefix=new,&lt;=abc123450123456789012345678901234567890:prefix=old)
</code></pre>
<p>This applies <code>:prefix=old</code> to commit <code>abc12345...</code> and all its ancestors, and <code>:prefix=new</code> only to commit <code>def45678...</code>.</p>
<pre><code>:rev(&lt;abc123450123456789012345678901234567890:prefix=old,_:prefix=default)
</code></pre>
<p>This applies <code>:prefix=old</code> to all ancestors of that commit (but not the commit itself), and <code>:prefix=default</code> to all other commits (including that commit and any commits after it).</p>
<h3 id="prune-trivial-merge-commits-prunetrivial-merge"><a class="header" href="#prune-trivial-merge-commits-prunetrivial-merge">Prune trivial merge commits <strong>:prune=trivial-merge</strong></a></h3>
<p>Produce a history that skips all merge commits whose tree is identical to the first parents
tree.
Normally Josh will keep all commits in the filtered history whose tree differs from any of it’s
parents.</p>
<h3 id="commit-message-rewriting-template-or-templateregex"><a class="header" href="#commit-message-rewriting-template-or-templateregex">Commit message rewriting <strong><code>:"template"</code></strong> or <strong><code>:"template";"regex"</code></strong></a></h3>
<p>Rewrite commit messages using a template string. The template can use regex capture groups
to extract and reformat parts of the original commit message, as well as special template variables
for commit metadata.</p>
<p><strong>Simple message replacement:</strong></p>
<pre><code>:"New message"
</code></pre>
<p>This replaces all commit messages with “New message”.</p>
<p><strong>Using regex with named capture groups:</strong></p>
<pre><code>:"[{type}] {message}";"(?s)^(?P&lt;type&gt;fix|feat|docs): (?P&lt;message&gt;.+)$"
</code></pre>
<p>This uses a regex to match the original commit message and extract named capture groups (<code>{type}</code> and <code>{message}</code>)
which are then used in the template. The regex <code>(?s)^(?P&lt;type&gt;fix|feat|docs): (?P&lt;message&gt;.+)$</code> matches
commit messages starting with “fix:”, “feat:”, or “docs:” followed by a message, and the template
reformats them as <code>[type] message</code>.</p>
<p><strong>Using template variables:</strong>
The template supports special variables that provide access to commit metadata:</p>
<ul>
<li><code>{#}</code> - The tree object ID (SHA-1 hash) of the commit</li>
<li><code>{@}</code> - The commit object ID (SHA-1 hash)</li>
<li><code>{/path}</code> - The content of the file at the specified path in the commit tree</li>
<li><code>{#path}</code> - The object ID (SHA-1 hash) of the tree entry at the specified path</li>
</ul>
<p>Regex capture groups take priority over template variables. If a regex capture group has the same name as a template variable, the capture group value will be used.</p>
<p>Example:</p>
<pre><code>:"Message: {#} {@}"
</code></pre>
<p>This replaces commit messages with “Message: “ followed by the tree ID and commit ID.</p>
<p><strong>Combining regex capture groups and template variables:</strong></p>
<pre><code>:"[{type}] {message} (commit: {@})";"(?s)^(?P&lt;type&gt;Original) (?P&lt;message&gt;.+)$"
</code></pre>
<p>This combines regex capture groups (<code>{type}</code> and <code>{message}</code>) with template variables (<code>{@}</code> for the commit ID).</p>
<p><strong>Removing text from messages:</strong></p>
<pre><code>:"";"TODO"
</code></pre>
<p>This removes all occurrences of “TODO” from commit messages by matching “TODO” and replacing it with an empty string.
The regex pattern can use <code>(?s)</code> to enable dot-all mode (so <code>.</code> matches newlines), allowing it to work with
multi-line commit messages that include both a subject line and a body.</p>
<h3 id="pin-tree-contents"><a class="header" href="#pin-tree-contents">Pin tree contents</a></h3>
<p>Pin revision of a subtree to revision of the parent commit.</p>
<p>In practical terms, it means that file and folder updates are “held off”, and revisions are “pinned”.
If a tree entry already existed in the parent revision, that version will be chosen.
Otherwise, the tree entry will not appear in the filtered commit.</p>
<p>The source of the parent revision is always the first commit parent.</p>
<p>Note that this filter is only practical when used with <code>:hook</code> or <code>workspace.josh</code>,
as it should apply per-revision only. Applying <code>:pin</code> for the whole history
will result in the subtree being excluded from all revisions.</p>
<p>Refer to <code>pin_filter_workspace.t</code> and <code>pin_filter_hook.t</code> for reference.</p>
<h2 id="filter-order-matters"><a class="header" href="#filter-order-matters">Filter order matters</a></h2>
<p>Filters are applied in the left-to-right order they are given in the filter specification,
and they are <code>not</code> commutative.</p>
<p>For example, this command will filter out just the josh documentation, and store it in a
ref named <code>FILTERED_HEAD</code>:</p>
<pre><code>$ josh-filter :/docs:prefix=josh-docs
</code></pre>
<p>However, <code>this</code> command will produce an empty branch:</p>
<pre><code>$ josh-filter :prefix=josh-docs:/docs
</code></pre>
<p>What’s happening in the latter command is that because the prefix filter is applied first, the
entire <code>josh</code> history already lives within the <code>josh-docs</code> directory, as it was just
transformed to exist there. Thus, to still get the docs, the command would need to be:</p>
<pre><code>$ josh-filter :prefix=josh-docs:/josh-docs/docs
</code></pre>
<p>which will contain the josh documentation at the base of the tree. We’ve lost the prefix, what
gives?? Because the original git tree was already transformed, and then the subdirectory filter
was applied to pull documentation from <code>josh-docs/docs</code>, the prefix is gone - it was filtered out
again by the subdirectory filter. Thus, the order in which filters are provided is crucial, as each
filter further transforms the latest transformation of the tree.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../guide/importing.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../reference/proxy.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../guide/importing.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../reference/proxy.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid-eefea253.min.js"></script>
        <script src="../mermaid-init-ccf746f1.js"></script>



    </div>
    </body>
</html>
